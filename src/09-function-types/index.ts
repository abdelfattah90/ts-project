/*
==============================================================================
๐ ุงูุฏููู ุงูุดุงูู ูุฅุชูุงู ุงูุฏูุงู ูู TypeScript (Function Types)
==============================================================================
ูุฑุญุจุงู ุจู! ูุฐุง ุงูููู ูู ูุฑุฌุนู ุงูุนููู ูุงููุธุฑู.
ุชู ุฏูุฌ ุงูุดุฑุญ ุงููุธุฑู ูุน ุงูุฃูุซูุฉ ุงูุจุฑูุฌูุฉ ูุชุชููู ูู ุงูููู ูุงูุชุทุจูู ูู ุขู ูุงุญุฏ.

๐ ุงูููุฑุณ:
1. Function Type Expressions (ุชุนุงุจูุฑ ุฃููุงุน ุงูุฏูุงู)
2. Call Signatures (ุชูููุนุงุช ุงูุงุณุชุฏุนุงุก)
3. Construct Signatures (ุชูููุนุงุช ุงูุจูุงุก)
4. Generic Functions (ุงูุฏูุงู ุงููุนููุฉ/ุงูุฏููุงููููุฉ)
5. Function Overloads (ุชุญููู ุงูุฏูุงู ุงูุฒุงุฆุฏ)
6. Rest Parameters (ุงููุนุงููุงุช ุงููุชุจููุฉ)
7. this Parameter (ุณูุงู this)
8. void vs never vs undefined (ุฃููุงุน ุงูุงุฑุฌุงุน ุงูุฎุงุตุฉ)
9. Callback Functions (ุฏูุงู ุงูุงุณุชุฏุนุงุก ุงูุฎููู)
10. Higher-Order Functions (ุงูุฏูุงู ุนุงููุฉ ุงูุฑุชุจุฉ)
11. Function Types in Angular (ุงุณุชุฎุฏุงูุงุช ุนูููุฉ)
12. Project: Simple Event System (ูุดุฑูุน ุชุทุจููู)
==============================================================================
*/

/*
==============================================================================
1๏ธโฃ Function Type Expressions
==============================================================================
โ ูุง ููุ
ุทุฑููุฉ ูุฎุชุตุฑุฉ ูุชุนุฑูู "ุดูู" ุงูุฏุงูุฉ ุจุงุณุชุฎุฏุงู ุงูู Arrow Syntax.
ูุญุฏุฏ ุฃููุงุน ุงููุฏุฎูุงุช (Parameters) ูููุน ุงููุฎุฑุฌ (Return Type).

โ ููุงุฐุง ูุณุชุฎุฏููุ
ูุถูุงู ุฃู ุงููุชุบูุฑ ูุง ููุจู ุฅูุง ุฏุงูุฉ ุจููุงุตูุงุช ูุญุฏุฏุฉุ ููุง ูููุน ุงูุฃุฎุทุงุก ุฃุซูุงุก ุงูุชูุฑูุฑ.

โ ุฃูู ูุณุชุฎุฏููุ
ุนูุฏ ุชุนุฑูู ูุชุบูุฑุงุช ุณุชุญูู ุฏูุงูุ ุฃู ุนูุฏ ุชุนุฑูู ูุงุฌูุงุช (Interfaces) ุชุญุชูู ุนูู ุฏูุงู ุจุณูุทุฉ.

โ ูุชู ูุณุชุฎุฏููุ
ุนูุฏูุง ุชููู ุงูุฏุงูุฉ "stateless" (ููุณ ููุง ุฎุตุงุฆุต ุฅุถุงููุฉ) ููุฑูุฏ ุชุนุฑููุงู ุณุฑูุนุงู ูููุฑูุกุงู.
*/

// ุงูุตูุบุฉ: (param: Type) => ReturnType
type MathOperation = (a: number, b: number) => number;

// ุชุทุจูู ุงูููุน ุนูู ุงูุฏูุงู
const add: MathOperation = (a, b) => a + b;
const subtract: MathOperation = (a, b) => a - b;
const multiply: MathOperation = (a, b) => a * b;

// ๐ก ุงูุงุณุชุฎุฏุงู: TypeScript ุณูุตุฑุฎ ุฅุฐุง ุญุงููุช ุชูุฑูุฑ ูุตูุต ุจุฏูุงู ูู ุฃุฑูุงู
console.log("Add:", add(5, 3));      // Output: 8

// ูุซุงู: ุฏุงูุฉ ุชูุจู ุฏุงูุฉ ุฃุฎุฑู ูู Parameter (Strategy Pattern)
function calculate(op: MathOperation, x: number, y: number): number {
    return op(x, y);
}

console.log("Calculate:", calculate(multiply, 10, 5)); // Output: 50


/*
==============================================================================
2๏ธโฃ Call Signatures
==============================================================================
โ ูุง ููุ
ุชุนุฑูู ูููุน ุงูุฏุงูุฉ ุจุงุณุชุฎุฏุงู ุตูุบุฉ ุงููุงุฆู (Object Literal). ูุณูุญ ููุง ูุฐุง ุจุชุนุฑูู ุฏุงูุฉ
ุชูุชูู "ุฎุตุงุฆุต" (Properties) ุจุงูุฅุถุงูุฉ ูููููุง ูุงุจูุฉ ููุงุณุชุฏุนุงุก.

โ ููุงุฐุง ูุณุชุฎุฏููุ
ูุฃู ูู JavaScriptุ ุงูุฏูุงู ูู ูุงุฆูุงุช (Objects) ููููู ุฃู ุชุญุชูู ุนูู ุญููู ูุซู `description` ุฃู `id`.

โ ุฃูู ูุณุชุฎุฏููุ
ูู ุงูููุชุจุงุช ุงููุชูุฏูุฉ (ูุซู jQuery ูุฏููุงู) ุฃู ุนูุฏ ุฅูุดุงุก ุฃุฏูุงุช (Utils) ุชุญูู ุฅุนุฏุงุฏุงุช ุฏุงุฎููุฉ.

โ ูุชู ูุณุชุฎุฏููุ
ุนูุฏูุง ุชุญุชุงุฌ ุงูุฏุงูุฉ ุฃู ุชุญูู ุจูุงูุงุช ูุตููุฉ (Metadata) ุนู ููุณูุง.
*/

type Formatter = {
    description: string;      // ุฎุงุตูุฉ
    (value: string): string;  // โ ูุฐุง ูู ุงูู Call Signature (ูุง ูุฌุนููุง ุฏุงูุฉ)
};

function createFormatter(desc: string): Formatter {
    // โ๏ธ ููุงุญุธุฉ: ูุณุชุฎุฏู casting ููุง ูุฃู JS ุชุณูุญ ุจุฅุถุงูุฉ ุฎุตุงุฆุต ููุฏูุงู
    const fn: any = (value: string) => `[${desc}] ${value}`;
    fn.description = desc;
    return fn;
}

const logger = createFormatter("LOG");
console.log(logger("System started")); // ุงุณุชุฏุนุงุก ูุฏุงูุฉ
console.log(logger.description);       // ุงููุตูู ูุฎุงุตูุฉ


/*
==============================================================================
3๏ธโฃ Construct Signatures
==============================================================================
โ ูุง ููุ
ุชุญุฏูุฏ ููุน ุฏุงูุฉ "ุจูุงุก" (Constructor)ุ ุฃู ุฏุงูุฉ ูููู ุงุณุชุฏุนุงุคูุง ุจุงุณุชุฎุฏุงู ูููุฉ `new`.

โ ููุงุฐุง ูุณุชุฎุฏููุ
ููุชุนุงูู ูุน ุงูู Classes ููููุ ูุชูุฑูุฑูุง ูู Parameters (ูุซูุงู ูู Factory Pattern).

โ ุฃูู ูุณุชุฎุฏููุ
ูู ุฃูุธูุฉ ุงูู Dependency Injection (ูุซู Angular) ุฃู ุนูุฏ ุฅูุดุงุก ุฏูุงู ุชููู ุจุฅูุดุงุก ูุงุฆูุงุช ุฏููุงููููุงู.

โ ูุชู ูุณุชุฎุฏููุ
ุนูุฏูุง ุชุฑูุฏ ุชูุฑูุฑ "ุตูู" (Class) ููุณู ูููุณ "ูุณุฎุฉ" (Instance) ููู.
*/

type PointConstructor = {
    new(x: number, y: number): { x: number; y: number };
};

class Point {
    constructor(public x: number, public y: number) { }
}

// ุฏุงูุฉ ูุตูุน ุชูุจู ุงูููุงุณ ูุชูุดุฆ ููู ูุณุฎุฉ
function createPoint(ctor: PointConstructor, x: number, y: number) {
    return new ctor(x, y);
}

const p = createPoint(Point, 10, 20);
console.log("Point created:", p);


/*
==============================================================================
4๏ธโฃ Generic Functions
==============================================================================
โ ูุง ููุ
ุฏูุงู ูุฑูุฉ ูุง ุชุญุฏุฏ ููุน ุงูุจูุงูุงุช ูุณุจูุงูุ ุจู ุชุณุชุฎุฏู "ูุชุบูุฑุงู ููููุน" (ูุซู `<T>`)
ูุชู ุชุญุฏูุฏู ูุญุธุฉ ุงูุงุณุชุฏุนุงุก.

โ ููุงุฐุง ูุณุชุฎุฏููุ
ููุชุงุจุฉ ููุฏ ูุงุจู ูุฅุนุงุฏุฉ ุงูุงุณุชุฎุฏุงู (Reusable) ูุนูู ูุน ุฃู ููุน ุจูุงูุงุช ุฏูู ููุฏุงู ุงูู Type Safety.

โ ุฃูู ูุณุชุฎุฏููุ
ูู ุฏูุงู ุงูุชุนุงูู ูุน ุงููุตูููุงุชุ ุทูุจุงุช ุงูู APIุ ูุฃุฏูุงุช ุงููุนุงูุฌุฉ ุงูุนุงูุฉ.

โ ูุชู ูุณุชุฎุฏููุ
ุนูุฏูุง ูููู ููุทู ุงูุฏุงูุฉ ูุงุญุฏุงูุ ูููู ููุน ุงูุจูุงูุงุช ุงููุฏุฎูุฉ ูุฎุชูู ูู ูุฑุฉ ูุฃุฎุฑู.
*/

// <T> ูู ูุชุบูุฑ ููุชูุท ููุน ุงูุจูุงูุงุช ุงูุฐู ููุฑุฑู ุงููุณุชุฎุฏู
function getFirst<T>(arr: T[]): T | undefined {
    return arr[0];
}

// ๐ก TypeScript ูุณุชูุชุฌ ุงูููุน ุชููุงุฆูุงู
const num = getFirst([1, 2, 3]);       // T ูุตุจุญ number
const str = getFirst(["a", "b", "c"]); // T ูุตุจุญ string

// Constraints: ุชูููุฏ ุงูููุน (ูุฌุจ ุฃู ูุญุชูู ุนูู length)
function getLength<T extends { length: number }>(item: T): number {
    return item.length;
}

getLength("Hello");   // ููุจูู (string ูู length)
getLength([1, 2, 3]); // ููุจูู (Array ูู length)
// getLength(123);    // โ ุฎุทุฃ: ุงูุฃุฑูุงู ููุณ ููุง length


/*
==============================================================================
5๏ธโฃ Function Overloads
==============================================================================
โ ูุง ููุ
ุชูููุฑ ุนุฏุฉ "ุชูููุนุงุช" (Signatures) ูุฏุงูุฉ ูุงุญุฏุฉุ ุจุญูุซ ูููู ุงุณุชุฏุนุงุคูุง ุจุทุฑู ูุฎุชููุฉุ
ูุน ูุฌูุฏ ุชูููุฐ (Implementation) ูุงุญุฏ ูุนุงูุฌ ูู ุงูุญุงูุงุช.

โ ููุงุฐุง ูุณุชุฎุฏููุ
ูุฌุนู ูุงุฌูุฉ ุงูุฏุงูุฉ (API) ุฐููุฉ ููุฑูุฉ ูุณููุฉ ุงูุงุณุชุฎุฏุงู ูููุทูุฑูู ุงูุขุฎุฑูู.

โ ุฃูู ูุณุชุฎุฏููุ
ูู ููุชุจุงุช ุงูู DOM ุฃู ุงูุชุนุงูู ูุน ุงูุชูุงุฑูุฎุ ุญูุซ ูููู ููุฏุงูุฉ ุฃู ุชูุจู ุฑูู ูุงุญุฏ ุฃู ุนุฏุฉ ุฃุฑูุงู.

โ ูุชู ูุณุชุฎุฏููุ
ุนูุฏูุง ุชููู ุงูุฏุงูุฉ ุจููุณ ุงููููุฉ ุฌููุฑูุงู ููู ุงููุฏุฎูุงุช ุชุฎุชูู ุฌุฐุฑูุงู ูู ุงูุดูู ุฃู ุงูุนุฏุฏ.
*/

// 1. ุงูุชูููุนุงุช (ูุง ูุฑุงู ุงููุณุชุฎุฏู)
function makeDate(timestamp: number): Date;
function makeDate(year: number, month: number, day: number): Date;

// 2. ุงูุชูููุฐ (ุงูููุฏ ุงููุนูู - ูุฎูู ุนู ุงููุณุชุฎุฏู)
function makeDate(a: number, b?: number, c?: number): Date {
    if (b !== undefined && c !== undefined) {
        return new Date(a, b - 1, c); // ุงูุญุงูุฉ ุงูุซุงููุฉ
    }
    return new Date(a); // ุงูุญุงูุฉ ุงูุฃููู
}

const d1 = makeDate(12345678);       // Timestamp
const d2 = makeDate(2024, 11, 25);   // Y, M, D


/*
==============================================================================
6๏ธโฃ Rest Parameters
==============================================================================
โ ูุง ููุ
ุงุณุชุฎุฏุงู ุงููุนุงูู `...args` ูุชุฌููุน ุนุฏุฏ ุบูุฑ ูุญุฏูุฏ ูู ุงููุฏุฎูุงุช ูู ูุตูููุฉ ูุงุญุฏุฉ.

โ ููุงุฐุง ูุณุชุฎุฏููุ
ููุชุนุงูู ูุน ุงูุฏูุงู ุงูุชู ูุง ูุนุฑู ุนุฏุฏ ูุฏุฎูุงุชูุง ูุณุจูุงู (Variadic Functions).

โ ุฃูู ูุณุชุฎุฏููุ
ูู ุฏูุงู ุงูุฌูุน ุงูุฑูุงุถูุ ุฃู ุฏูุงู ุงูู Logging ุงูุชู ุชูุจู ุฃู ุนุฏุฏ ูู ุงูุฑุณุงุฆู.

โ ูุชู ูุณุชุฎุฏููุ
ุจุฏูุงู ูู ุงุณุชุฎุฏุงู ุงููุงุฆู ุงููุฏูู `arguments` ููุญุตูู ุนูู ููุน ูุตูููุฉ ุญูููู ููุญููู (Typed Array).
*/

function sum(...nums: number[]): number {
    return nums.reduce((total, n) => total + n, 0);
}

console.log("Sum:", sum(1, 2, 3, 4, 5)); // ููุจู ุฃู ุนุฏุฏ


/*
==============================================================================
7๏ธโฃ this Parameter
==============================================================================
โ ูุง ููุ
ุชุญุฏูุฏ ููุน `this` ุจุดูู ุตุฑูุญ ูุฃูู ุจุงุฑุงููุชุฑ ูู ุงูุฏุงูุฉ (ูููู ูุง ูุชู ุชูุฑูุฑู ูุนููุงู ุนูุฏ ุงูุชุดุบูู).

โ ููุงุฐุง ูุณุชุฎุฏููุ
ูููุน TypeScript ูู ุงุนุชุจุงุฑ `this` ูู ููุน `any`ุ ููุชุฌูุจ ุฃุฎุทุงุก ุงูู Runtime ุนูุฏ ุถูุงุน ุงูุณูุงู.

โ ุฃูู ูุณุชุฎุฏููุ
ุนูุฏ ุชูุฑูุฑ ุฏูุงู (Callbacks) ุชุญุชุงุฌ ูููุตูู ูุจูุงูุงุช ุงููุงุฆู ุงูุฃุตููุ ุฎุงุตุฉ ูู ุจุฑูุฌุฉ ุงูู OOP.

โ ูุชู ูุณุชุฎุฏููุ
ุนูุฏ ุงุณุชุฎุฑุงุฌ ุฏุงูุฉ ูู ูุงุฆู ูุงุณุชุฎุฏุงููุง ุจุดูู ูููุตู.
*/

interface User {
    id: number;
    username: string;
}

function printUser(this: User) {
    // ุงูุขู TS ูุนุฑู ุฃู this ูุญุชูู ุนูู username
    console.log(`User: ${this.username}`);
}

const user: User = { id: 1, username: "Ali" };

// printUser(); // โ ุฎุทุฃ: ูุฌุจ ุงุณุชุฏุนุงุคูุง ุถูู ุณูุงู User
printUser.call(user); // โ ุตุญูุญ


/*
==============================================================================
8๏ธโฃ void vs never vs undefined
==============================================================================
โ ูุง ููุ
- `void`: ุงูุฏุงูุฉ ุชูุชูู ููู ูุง ุชุฑุฌุน ูููุฉ ูููุฏุฉ (ุชุณุชุฎุฏู ููู Side Effects).
- `never`: ุงูุฏุงูุฉ **ูุง** ุชูุชูู ุฃุจุฏุงู (ุชุฑููุฉ ุฎุทุฃ ุฃู ุชุฏุฎู ูู ุญููุฉ ูุง ููุงุฆูุฉ).
- `undefined`: ุงูุฏุงูุฉ ุชุฑุฌุน ูููุฉ `undefined` ูุนููุงู.

โ ููุงุฐุง ูุณุชุฎุฏููุ
ูุชูุถูุญ ููุฉ ุงููุจุฑูุฌ ูุณููู ุงูุฏุงูุฉ ููุขุฎุฑูู ููููุชุฑุฌู (Compiler).

โ ูุชู ูุณุชุฎุฏููุ
- `void`: ูุน `console.log` ุฃู ุชุนุฏูู ุงูู DOM.
- `never`: ูู ุฏูุงู ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุงููุงุชูุฉ.
*/

function logMsg(msg: string): void {
    console.log(msg); // โ ุชูุชูู ุงูุฏุงูุฉ ูุชุนูุฏ ููุชูููุฐ
}

function fail(msg: string): never {
    throw new Error(msg); // โ ุชููู ุงูุชูููุฐ ุชูุงูุงู ููุง
}


/*
==============================================================================
9๏ธโฃ Callback Functions
==============================================================================
โ ูุง ููุ
ุชูุฑูุฑ ุฏุงูุฉ ูู Argument ูุฏุงูุฉ ุฃุฎุฑู ููุชู ุงุณุชุฏุนุงุคูุง ูุงุญูุงู.

โ ููุงุฐุง ูุณุชุฎุฏููุ
ุฃุณุงุณ ุงูุจุฑูุฌุฉ ุบูุฑ ุงููุชุฒุงููุฉ (Asynchronous) ูุงูุชุนุงูู ูุน ุงูุฃุญุฏุงุซ.

โ ุฃูู ูุณุชุฎุฏููุ
ูู `setTimeout`ุ ุทูุจุงุช ุงูุณูุฑูุฑุ ููุณุชูุนู ุงูุฃุญุฏุงุซ (Event Listeners).
*/

type Callback = (success: boolean) => void;

function saveData(data: string, cb: Callback) {
    console.log(`Saving ${data}...`);
    // ูุญุงูุงุฉ ุนูููุฉ ุญูุธ
    cb(true);
}

saveData("User Profile", (isSuccess) => {
    console.log(isSuccess ? "Saved!" : "Failed");
});


/*
==============================================================================
๐ Higher-Order Functions (HOF)
==============================================================================
โ ูุง ููุ
ุฏุงูุฉ ุชุฃุฎุฐ ุฏุงูุฉ ููุฏุฎูุ ุฃู ุชูุฑุฌุน ุฏุงูุฉ ููุฎุฑุฌ.

โ ููุงุฐุง ูุณุชุฎุฏููุ
ูุฅูุดุงุก ุฏูุงู ูุฑูุจุฉุ ูุชุบููู ุงูููุทู (Logic encapsulation)ุ ูุซู ุฅุถุงูุฉ Logging ููู ุงูุฏูุงู.

โ ุฃูู ูุณุชุฎุฏููุ
ูู Redux Middlewareุ ููู Angular Interceptorsุ ููู Decorators.
*/

// ุฏุงูุฉ ุชููู ุจุฅุถุงูุฉ Log ูุฃู ุฏุงูุฉ ุญุณุงุจูุฉ
function withLogger(fn: (x: number, y: number) => number) {
    return (x: number, y: number) => {
        console.log(`Input: ${x}, ${y}`);
        const result = fn(x, y);
        console.log(`Output: ${result}`);
        return result;
    };
}

const loggedAdd = withLogger((a, b) => a + b);
loggedAdd(5, 7);


/*
==============================================================================
1๏ธโฃ1๏ธโฃ Function Types in Angular
==============================================================================
โ ุฃูู ูุณุชุฎุฏู ูุฐุง ูู Angularุ
1. **Event Emitters:** ูู ุชุทุจูู ูููููู Callbacks ู Generics.
2. **Http Interceptors:** ุชุนุชูุฏ ุนูู HOFs.
3. **Route Guards:** ุฏูุงู ุชูุฑุฑ ุฅููุงููุฉ ุงููุฑูุฑ (ุชูุฑุฌุน boolean ุฃู Observable).
*/

// ูุซุงู ูุญุงูุงุฉ ูู Event Handler ูู Angular
interface SimpleEvent {
    target: any;
    timestamp: number;
}

// ุชุนุฑูู ููุน ุงูุฏุงูุฉ ุงูุชู ุชุนุงูุฌ ุงูุญุฏุซ
type EventHandler = (event: SimpleEvent) => void;

function onButtonClick(handler: EventHandler) {
    const fakeEvent = { target: "Button", timestamp: Date.now() };
    handler(fakeEvent);
}

onButtonClick((e) => console.log("Button clicked at", e.timestamp));


/*
==============================================================================
โญ ูุซุงู ุชุทุจููู ุนููู: ูุธุงู ุฃุญุฏุงุซ (Event System)
==============================================================================
ูุฐุง ุงููุซุงู ูุฌูุน:
- Generics (ููุชุนุงูู ูุน ุฃู ููุน ุจูุงูุงุช)
- Function Types (ูุชุนุฑูู ุงูู Handlers)
- Class Methods
*/

// ุชุนุฑูู ููุน ุงูู Handler ุจุงุณุชุฎุฏุงู Generic <T>
type Listener<T> = (data: T) => void;

class EventEmitter<T> {
    // ูุตูููุฉ ูุชุฎุฒูู ุงูุฏูุงู (ุงููุณุชูุนูู)
    private listeners: Listener<T>[] = [];

    // ุฏุงูุฉ ููุชุณุฌูู (Subscribe)
    subscribe(listener: Listener<T>) {
        this.listeners.push(listener);

        // ูุฑุฌุน ุฏุงูุฉ ูุฅูุบุงุก ุงูุงุดุชุฑุงู (Cleanup pattern)
        return () => {
            this.listeners = this.listeners.filter(l => l !== listener);
        };
    }

    // ุฏุงูุฉ ููุจุซ (Publish/Emit)
    emit(data: T) {
        this.listeners.forEach(listener => listener(data));
    }
}

// --- ุชุฌุฑุจุฉ ุงููุธุงู ---
const chatChannel = new EventEmitter<string>();

// ุงููุดุชุฑู ุงูุฃูู
const unsubscribe1 = chatChannel.subscribe(msg => console.log("User 1 received:", msg));

// ุงููุดุชุฑู ุงูุซุงูู
chatChannel.subscribe(msg => console.log("User 2 received:", msg.toUpperCase()));

// ุฅุฑุณุงู ุฑุณุงูุฉ
chatChannel.emit("Hello World!");

// ุฅูุบุงุก ุงุดุชุฑุงู ุงูุฃูู ูุฅุฑุณุงู ุฑุณุงูุฉ ุฃุฎุฑู
unsubscribe1();
chatChannel.emit("Second Message"); // ุณูุณุชูููุง User 2 ููุท